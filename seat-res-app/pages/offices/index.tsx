import React, { ReactElement } from "react";
import Head from "next/head";
import client from "../../apollo-client";
import { Office } from "../../types";
import { OfficeModal, OfficesTable } from "./components";
import { Layout, Button, PageTitle } from "../../components/ui";
import { useModalStore } from "../../stores";
import { getOffices } from "../../services/queries";
import { useMutation } from "@apollo/client";
import { createOffice } from "../../services/mutations";

interface OfficesProps {
  offices: Office[];
}

export default function OfficesPage({ offices }: OfficesProps) {
  const openModal = useModalStore((state) => state.setIsOpen);
  const [addOffice, { data, loading, error }] = useMutation(createOffice);

  return (
    <main className="px-8 py-2">
      <Head>
        <title>Seat Reservation</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <PageTitle>
        Offices
        <Button
          primary
          onClick={() =>
            openModal(true, {
              cancelText: "Cancel",
              confirmText: "Save",
              content: <OfficeModal />,
              data: { officeName: "" },
              title: "Add Office",
              onConfirmAction: (data) =>
                addOffice({ variables: { name: data.officeName, buildingId: 1 } }),
            })
          }
        >
          Add new
        </Button>
      </PageTitle>
      <OfficesTable data={offices} />
    </main>
  );
}

OfficesPage.setLayout = function getLayout(page: ReactElement) {
  return <Layout>{page}</Layout>;
};

export async function getStaticProps() {
  const { data } = await client.query({ query: getOffices });
  return {
    props: {
      offices: data.offices,
    },
  };
}
